# HTTP服务器功能

ltrack现在支持内置的HTTP服务器，可以通过Web界面实时查看各种监控器的日志信息。

## 配置

在`policy.toml`配置文件中添加以下配置项：

```toml
# HTTP服务器配置
[http_server]
enabled = true  # 是否启用HTTP服务器
port = 8088     # HTTP服务器监听端口
host = "0.0.0.0" # HTTP服务器监听地址，0.0.0.0表示监听所有网络接口
```

## 功能

HTTP服务器提供以下功能：

1. **统一仪表盘**：
   - 单页面应用，通过选项卡切换不同的监控器日志
   - 默认启用自动刷新，每5秒更新一次日志数据
   - 新的日志条目会自动添加到顶部，实现逐条向上滚动的效果

2. **控制功能**：
   - 暂停/恢复自动刷新
   - 清空当前显示的日志
   - 设置最大显示的日志条数，可自定义（10-1000条）

3. **三种监控器日志**：
   - **网络监控**：显示网络流量和连接信息
   - **文件监控**：显示文件变化和访问信息
   - **执行监控**：显示命令执行信息

4. **API接口**：
   - `/api/logs?type={日志类型}`：返回JSON格式的日志数据
   - 可用于自定义集成或前端开发

5. **历史日志加载**：
   - 自动从存储文件中加载历史日志记录
   - 支持JSON和NDJSON格式的日志文件解析
   - 支持文本格式的日志文件解析
   - 自动检测并加载日志轮转备份文件

## 使用方法

1. 启动ltrack：
   ```bash
   ./bin/ltrack -c policy.toml
   ```

2. 打开浏览器访问：
   ```
   http://服务器地址:8088/
   ```

3. 在单一页面上，通过选项卡即可切换不同类型的监控日志：
   - 网络监控
   - 文件监控
   - 执行监控

## 特性

- **实时更新**：默认开启自动刷新，每5秒刷新一次
- **逐条向上滚动**：新的日志条目会显示在列表顶部，并带有淡入动画效果
- **无需手动刷新**：所有日志更新会自动获取并显示
- **自动去重**：已经显示过的日志不会重复出现
- **响应式设计**：适应不同屏幕尺寸的设备
- **历史数据查看**：即使是应用程序启动前记录的日志也能查看

## 注意事项

- HTTP服务器会在内存中保存最近1000条每种类型的日志
- 支持从存储文件中加载历史日志，但仅限于`storage.type = "file"`配置
- 程序重启后，HTTP服务器会自动从存储文件重新加载日志记录
- 为了安全起见，在生产环境中应该考虑设置防火墙规则，限制HTTP服务器的访问

## 日志文件格式支持

HTTP服务器支持从以下格式的日志文件中加载历史记录：

1. **JSON/NDJSON格式**：
   - 每行一个完整的JSON对象
   - 必须包含`@timestamp`和`type`字段
   - 所有其他字段会被作为数据字段显示

2. **文本格式**：
   - 格式为`[时间戳] 类型: 内容`
   - 时间戳必须符合RFC3339格式
   - 如果格式不匹配，会尽量提取可用信息 